<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Trung TÃ¢m Ngoáº¡i Ngá»¯ Viá»‡t Ãšc VÄ©nh Long</title>
    <link rel="stylesheet" href="style.css?v=20241228">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <!-- Form thÃ´ng tin há»c sinh -->
    <div id="student-form">
        <div class="logo">
            <img src="assets/logo.svg" alt="Logo Trung TÃ¢m" class="center-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div class="logo-fallback" style="display: none;">ğŸ“</div>
            <h2>Trung TÃ¢m Ngoáº¡i Ngá»¯ Viá»‡t Ãšc VÄ©nh Long</h2>
            <p>KhÃ¡m phÃ¡ nÄƒng lá»±c ngoáº¡i ngá»¯ cá»§a báº¡n!</p>
        </div>
        
        <form id="info-form">
            <div class="form-group">
                <label for="student-name">ğŸ‘¤ Há» vÃ  TÃªn *</label>
                <input type="text" id="student-name" placeholder="VD: Nguyá»…n VÄƒn A" required>
            </div>
            
            <div class="form-group">
                <label for="student-phone">ğŸ“± Sá»‘ Ä‘iá»‡n thoáº¡i/Zalo *</label>
                <input type="tel" id="student-phone" placeholder="VD: 0901234567" required pattern="[0-9]{10,11}">
            </div>
            
            <div class="form-group">
                <label for="student-class">ğŸ¯ Chá»n khÃ³a há»c mÃ  báº¡n muá»‘n tham gia Ä‘á»ƒ thá»­ sá»©c *</label>
                <select id="student-class" required>
                    <option value="">-- Chá»n loáº¡i lá»›p há»c --</option>
                    <option value="tieu-hoc">ğŸ§’ Khá»‘i Tiá»ƒu há»c (Starters - Movers - Flyers)</option>
                    <option value="thcs">ğŸ‘¨â€ğŸ“ Khá»‘i THCS (Pre-KET - PET)</option>
                    <option value="thpt">ğŸ“ Luyá»‡n thi THPT</option>
                    <option value="tieng-trung">ğŸ‡¨ğŸ‡³ Tiáº¿ng Trung cÆ¡ báº£n</option>
                    <option value="tieng-trung-11">ğŸ‡¨ğŸ‡³ Tiáº¿ng Trung cÆ¡ báº£n 1-1</option>
                    <option value="tieng-anh-giao-tiep">ğŸ’¬ Tiáº¿ng Anh giao tiáº¿p</option>
                    <option value="tieng-anh-giao-tiep-11">ğŸ’¬ Tiáº¿ng Anh giao tiáº¿p 1-1</option>
                    <option value="chung-chi">ğŸ† Luyá»‡n thi chá»©ng chá»‰ (B1, B2, TOEIC, IELTS)</option>
                </select>
            </div>
            
            <button type="submit" class="btn-primary">Báº¯t Ä‘áº§u Quiz ğŸš€</button>
        </form>
        
        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Äang lÆ°u thÃ´ng tin...</p>
        </div>
    </div>

    <!-- Container cho cÃ¡c bÆ°á»›c tiáº¿p theo -->
    <div id="quiz-container" style="display: none;"></div>
    <div id="result-container" style="display: none;"></div>
    <div id="wheel-container" style="display: none;"></div>
    <div id="final-container" style="display: none;"></div>

    <!-- Firebase SDK -->
    <!-- Firebase SDK v10.7.1 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, push, onValue, serverTimestamp, increment, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        // Make Firebase modules available globally for compatibility
        window.firebase = {
            initializeApp,
            database: {
                getDatabase,
                ref,
                set,
                get,
                push,
                onValue,
                serverTimestamp,
                increment,
                update
            }
        };
    </script>

    <!-- Fallback Mock Firebase (loads if CDN is blocked) -->
    <script src="assets/js/firebase-mock.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/firebase-config.js?v=20241228"></script>
    <script src="config.js?v=20241228"></script>
    <script src="js/sync-service.js?v=20241228"></script>
    <script src="js/student.js?v=20241228"></script>

    <!-- Connection Status Indicator -->
    <div id="connection-status" style="position: fixed; bottom: 20px; right: 20px; padding: 8px 12px; background: #3498db; color: white; border-radius: 20px; font-size: 12px; z-index: 1000; display: none;">
        <span id="connection-icon">ğŸŒ</span>
        <span id="connection-text">Äang káº¿t ná»‘i...</span>
    </div>

    <script>
        // Connection status indicator
        function updateConnectionStatus(event) {
            const statusEl = document.getElementById('connection-status');
            const iconEl = document.getElementById('connection-icon');
            const textEl = document.getElementById('connection-text');
            
            if (!statusEl) return;
            
            const { online, databaseType, error } = event.detail;
            
            statusEl.style.display = 'block';
            
            if (online) {
                statusEl.style.background = '#27ae60';
                iconEl.textContent = 'âœ…';
                textEl.textContent = `Online (${databaseType || 'Firebase'})`;
                
                // Hide after 3 seconds when online
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            } else {
                statusEl.style.background = error ? '#e74c3c' : '#f39c12';
                iconEl.textContent = 'âš ï¸';
                textEl.textContent = error ? 'Lá»—i káº¿t ná»‘i' : 'Offline';
            }
        }

        // Listen for connection status updates
        window.addEventListener('connectionStatusUpdate', updateConnectionStatus);
        window.addEventListener('firebaseConnectionUpdate', (event) => {
            updateConnectionStatus({
                detail: {
                    online: event.detail.connected,
                    databaseType: 'Firebase'
                }
            });
        });
    </script>
</body>
</html>