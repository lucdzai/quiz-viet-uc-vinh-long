<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Trung Tâm Ngoại Ngữ Việt Úc Vĩnh Long</title>
    <link rel="stylesheet" href="style.css?v=20241228">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <!-- Form thông tin học sinh -->
    <div id="student-form">
        <div class="logo">
            <img src="assets/logo.svg" alt="Logo Trung Tâm" class="center-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <div class="logo-fallback" style="display: none;">🎓</div>
            <h2>Trung Tâm Ngoại Ngữ Việt Úc Vĩnh Long</h2>
            <p>Khám phá năng lực ngoại ngữ của bạn!</p>
        </div>
        
        <form id="info-form">
            <div class="form-group">
                <label for="student-name">👤 Họ và Tên *</label>
                <input type="text" id="student-name" placeholder="VD: Nguyễn Văn A" required>
            </div>
            
            <div class="form-group">
                <label for="student-phone">📱 Số điện thoại/Zalo *</label>
                <input type="tel" id="student-phone" placeholder="VD: 0901234567" required pattern="[0-9]{10,11}">
            </div>
            
            <div class="form-group">
                <label for="student-class">🎯 Chọn khóa học mà bạn muốn tham gia để thử sức *</label>
                <select id="student-class" required>
                    <option value="">-- Chọn loại lớp học --</option>
                    <option value="tieu-hoc">🧒 Khối Tiểu học (Starters - Movers - Flyers)</option>
                    <option value="thcs">👨‍🎓 Khối THCS (Pre-KET - PET)</option>
                    <option value="thpt">🎓 Luyện thi THPT</option>
                    <option value="tieng-trung">🇨🇳 Tiếng Trung cơ bản</option>
                    <option value="tieng-trung-11">🇨🇳 Tiếng Trung cơ bản 1-1</option>
                    <option value="tieng-anh-giao-tiep">💬 Tiếng Anh giao tiếp</option>
                    <option value="tieng-anh-giao-tiep-11">💬 Tiếng Anh giao tiếp 1-1</option>
                    <option value="chung-chi">🏆 Luyện thi chứng chỉ (B1, B2, TOEIC, IELTS)</option>
                </select>
            </div>
            
            <button type="submit" class="btn-primary">Bắt đầu Quiz 🚀</button>
        </form>
        
        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Đang lưu thông tin...</p>
        </div>
    </div>

    <!-- Container cho các bước tiếp theo -->
    <div id="quiz-container" style="display: none;"></div>
    <div id="result-container" style="display: none;"></div>
    <div id="wheel-container" style="display: none;"></div>
    <div id="final-container" style="display: none;"></div>

    <!-- Firebase SDK -->
    <!-- Firebase SDK v10.7.1 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, push, onValue, serverTimestamp, increment, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        // Make Firebase modules available globally for compatibility
        window.firebase = {
            initializeApp,
            database: {
                getDatabase,
                ref,
                set,
                get,
                push,
                onValue,
                serverTimestamp,
                increment,
                update
            }
        };
    </script>

    <!-- Fallback Mock Firebase (loads if CDN is blocked) -->
    <script src="assets/js/firebase-mock.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/firebase-config.js?v=20241228"></script>
    <script src="config.js?v=20241228"></script>
    <script src="js/sync-service.js?v=20241228"></script>
    <script src="js/student.js?v=20241228"></script>

    <!-- Connection Status Indicator -->
    <div id="connection-status" style="position: fixed; bottom: 20px; right: 20px; padding: 8px 12px; background: #3498db; color: white; border-radius: 20px; font-size: 12px; z-index: 1000; display: none;">
        <span id="connection-icon">🌐</span>
        <span id="connection-text">Đang kết nối...</span>
    </div>

    <script>
        // Connection status indicator
        function updateConnectionStatus(event) {
            const statusEl = document.getElementById('connection-status');
            const iconEl = document.getElementById('connection-icon');
            const textEl = document.getElementById('connection-text');
            
            if (!statusEl) return;
            
            const { online, databaseType, error } = event.detail;
            
            statusEl.style.display = 'block';
            
            if (online) {
                statusEl.style.background = '#27ae60';
                iconEl.textContent = '✅';
                textEl.textContent = `Online (${databaseType || 'Firebase'})`;
                
                // Hide after 3 seconds when online
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            } else {
                statusEl.style.background = error ? '#e74c3c' : '#f39c12';
                iconEl.textContent = '⚠️';
                textEl.textContent = error ? 'Lỗi kết nối' : 'Offline';
            }
        }

        // Listen for connection status updates
        window.addEventListener('connectionStatusUpdate', updateConnectionStatus);
        window.addEventListener('firebaseConnectionUpdate', (event) => {
            updateConnectionStatus({
                detail: {
                    online: event.detail.connected,
                    databaseType: 'Firebase'
                }
            });
        });
    </script>
</body>
</html>